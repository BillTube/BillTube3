
#messagebuffer > div {
  content-visibility: auto;
  contain-intrinsic-size: auto 60px; /* Estimated height for layout calculations */
  position: relative;
  width: 100%;
  box-sizing: border-box;
}

#messagebuffer > div[class^="chat-msg-"],
#messagebuffer > div[class*=" chat-msg-"] {
  display: block !important;
  padding: 2px 16px !important;
  padding-left: 60px !important;
  position: relative;
  min-height: 22px;
}
#messagebuffer > div:has(img.channel-emote) > span:last-child,
#messagebuffer > div:has(img.chat-picture) > span:last-child {
  line-height: 0.8rem;
}
.btfw-new-user-msg {
  margin-top: 5px !important;
}

.btfw-new-user-msg:first-child {
  margin-top: 4px !important;
}

.btfw-continuation-msg {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

#messagebuffer .btfw-chat-avatarwrap {
  position: absolute;
  left: 16px;
  top: 4px;
  margin: 0 !important;
}

.btfw-continuation-msg .btfw-chat-avatarwrap {
  display: none !important;
}

#messagebuffer .timestamp {
  position: absolute;
  right: 16px;
  top: 4px;
  font-size: 0.75rem;
  color: rgba(255, 255, 255, 0.3) !important;
  opacity: 0;
  transition: opacity 0.1s;
}

#messagebuffer > div:hover .timestamp {
  opacity: 1;
}

#messagebuffer > div > span:has(.username) {
  display: block;
  line-height: 1.375rem;
  margin-bottom: 0;
}

.btfw-continuation-msg > span:has(.username) {
  display: none !important;
}

#messagebuffer .username {
  font-weight: 600;
  font-size: 1rem;
}

#messagebuffer > div > span:last-child {
  display: block;
  line-height: 1.375rem;
  word-wrap: break-word;
  margin-top: 0;
}

#messagebuffer img.channel-emote,
#messagebuffer img.chat-picture {
  display: block !important;
  margin: 4px 0;
  max-width: 100%;
}

#messagebuffer > div:hover {
  background: rgba(255, 255, 255, 0.03);
}

#messagebuffer .btfw-chat-avatar {
  /* Existing CSS remains the same */
  width: var(--btfw-avatar-size);
  height: var(--btfw-avatar-size);
  border-radius: 6px;
  object-fit: cover;
  display: block;
  
  /* âš¡ NEW: Prevent layout shift during image decode */
  image-rendering: auto;
  will-change: auto; /* Don't force layer promotion unless needed */
}

/* Optional: Add a subtle loading state for avatars */
#messagebuffer .btfw-chat-avatar[loading="lazy"]:not([src*="data:image"]) {
  background: color-mix(in srgb, var(--btfw-color-panel) 70%, transparent 30%);
}

/* Ensure consecutive messages render efficiently */
#messagebuffer > div.btfw-compact {
  margin-top: 2px !important;
  /* content-visibility inherited from parent */
}

#chatwrap{
  display:flex;
  flex-direction: column;
  height: 100%; /* Fill the chatcol container */
  min-height: 0;
  width: 100%;
  overflow: hidden; /* Prevent overflow issues */
}

#chatwrap .btfw-chat-topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  padding:8px 10px;
  margin:0 0 8px 0;
  border:1px solid var(--btfw-border);
  border-radius: var(--btfw-radius);
  flex-shrink: 0; /* Don't shrink these bars */
}

#chatwrap .btfw-chat-bottombar {
    display: flex;
    flex-direction: column;
    gap: 5px;
    margin: 5px 0 0px 0;
    flex-shrink: 0;
}

#chatwrap .btfw-chat-topbar{
  position: relative;
  overflow: visible;
}

.btfw-chat-topbar-left {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1 1 auto;
    min-width: 0;
    justify-content: center;
}

.btfw-chat-topbar-actions{
  display:flex;
  align-items:center;
  gap: 6px;
  flex: 0 0 auto;
}

#btfw-nowplaying-slot{
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

#btfw-mobile-modules-toggle{
  display: none;
  align-items: center;
  justify-content: center;
  padding: 6px 10px;
}

#btfw-grid.btfw-grid--vertical #btfw-mobile-modules-toggle{
  display: inline-flex;
}

#messagebuffer{
  flex: 1 1 auto;
  overflow: auto;
  min-height: 0; /* Allow shrinking */
  padding: 6px;
  /* Ensure smooth scrolling */
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

#messagebuffer > div.server-msg,
#messagebuffer > div.server-msg-reconnect {
  display: block;
}

/* Keep images/GIFs reasonable inside chat */
#messagebuffer .chat-msg img{
  max-width: 100%;
  height: auto;
}

/* ------------------------------------------------------------------
   Private message popovers ("PM bar")
   ------------------------------------------------------------------ */
.pm-panel {
  background: color-mix(in srgb, var(--btfw-overlay-bg) 96%, transparent 4%) !important;
  border: 1px solid var(--btfw-overlay-border) !important;
  border-radius: calc(var(--btfw-radius, 14px) + 2px);
  box-shadow: var(--btfw-overlay-shadow);
  color: var(--btfw-color-text);
  overflow: hidden;
  min-width: clamp(260px, 32vw, 360px);
}

.pm-panel .panel-heading {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 10px 14px;
  font-weight: 600;
  letter-spacing: 0.01em;
  background:
    linear-gradient(135deg,
      color-mix(in srgb, var(--btfw-color-panel) 88%, transparent 12%),
      color-mix(in srgb, var(--btfw-color-accent) 18%, transparent 82%)) !important;
  color: var(--btfw-color-text) !important;
  border-bottom: 1px solid color-mix(in srgb, var(--btfw-color-accent) 22%, transparent 78%);
}

.pm-panel .panel-heading .close {
  float: none;
  margin-left: auto;
  color: color-mix(in srgb, var(--btfw-color-text) 72%, transparent 28%);
  opacity: 1;
  transition: color 0.18s ease;
}

.pm-panel .panel-heading .close:hover,
.pm-panel .panel-heading .close:focus {
  color: var(--btfw-color-text);
  text-shadow: none;
}

.pm-panel .panel-body {
  padding: 12px 14px 14px;
  background: color-mix(in srgb, var(--btfw-overlay-elevated) 92%, transparent 8%);
  color: inherit;
}

.pm-panel .pm-buffer {
  max-height: 220px;
  overflow-y: auto;
  padding-right: 4px;
  margin: 0 -4px 8px 0;
}

.pm-panel hr {
  margin: 10px 0 12px;
  border-color: color-mix(in srgb, var(--btfw-color-text) 16%, transparent 84%);
}

.pm-panel .pm-input {
  background: color-mix(in srgb, var(--btfw-color-surface) 88%, transparent 12%);
  border: 1px solid color-mix(in srgb, var(--btfw-color-accent) 20%, transparent 80%);
  border-radius: var(--btfw-radius, 12px);
  color: var(--btfw-color-text);
  box-shadow: inset 0 1px 0 color-mix(in srgb, var(--btfw-color-bg) 55%, transparent 45%);
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.pm-panel .pm-input:focus {
  outline: none;
  border-color: color-mix(in srgb, var(--btfw-color-accent) 44%, transparent 56%);
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--btfw-color-accent) 24%, transparent 76%);
}

/* Controls row sits below messages, stays visible */
.btfw-controls-row{
  display:flex;
  align-items:flex-end;
  gap:8px;
  flex-wrap:wrap;
  width:100%;
  min-width:0;
  margin:0;
  padding:0;
  background: transparent;
  border: 0;
  border-radius: 0;
  flex: 1 1 auto;
}

.btfw-chat-composer {
    display: flex;
    flex-direction: column;
    gap: 5px;
    width: 100%;
    padding: 3px 10px 10px;
    border-radius: 20px;
    border: 1px solid color-mix(in srgb, var(--btfw-border) 70%, transparent 30%);
    background: 
 color-mix(in srgb, var(--btfw-color-panel) 88%, transparent 12%);
    box-shadow: 0 14px 34px 
 color-mix(in srgb, var(--btfw-color-bg) 38%, transparent 62%);
    position: relative;
    overflow: hidden;
}

.btfw-chat-composer::before{
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(60% 80% at 12% 46%, color-mix(in srgb, var(--btfw-color-accent) 44%, transparent 56%), transparent 58%);
  opacity: .65;
  pointer-events: none;
  z-index: 0;
}

.btfw-chat-composer > *{
  position: relative;
  z-index: 1;
}

.btfw-chat-composer-main{
  display:flex;
  flex-direction:column;
  gap:8px;
  width:100%;
}

.btfw-chat-composer-main > *{
  width:100%;
}

/* Guest login pill */
#guestlogin {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 6px 10px 6px 14px;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--btfw-border) 64%, transparent 36%);
  background: color-mix(in srgb, var(--btfw-color-panel) 82%, transparent 18%);
  box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--btfw-color-panel) 90%, transparent 10%),
              0 10px 24px color-mix(in srgb, var(--btfw-color-bg) 34%, transparent 66%);
  transition: border-color .2s ease, box-shadow .2s ease, background .2s ease;
}

#guestlogin:focus-within {
  border-color: color-mix(in srgb, var(--btfw-color-accent) 52%, transparent 48%);
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--btfw-color-accent) 18%, transparent 82%),
              0 12px 28px color-mix(in srgb, var(--btfw-color-bg) 40%, transparent 60%);
  background: color-mix(in srgb, var(--btfw-color-panel) 90%, transparent 10%);
}

#guestlogin .input-group-addon {
  flex: 0 0 auto;
  padding: 0;
  background: transparent;
  border: 0;
  font-weight: 600;
  letter-spacing: 0.02em;
  color: color-mix(in srgb, var(--btfw-color-chat-text) 88%, transparent 12%);
  text-transform: uppercase;
  font-size: 0.75rem;
  opacity: 0.85;
}

#guestlogin .form-control {
  flex: 1 1 auto;
  min-width: 0;
  background: transparent;
  border: 0;
  padding: 6px 4px 6px 0;
  color: var(--btfw-color-chat-text);
  font-weight: 500;
  box-shadow: none;
}

#guestlogin .form-control:focus {
  outline: none;
  box-shadow: none;
}

#guestlogin .form-control::placeholder {
  color: color-mix(in srgb, var(--btfw-color-chat-text) 62%, transparent 38%);
  opacity: 1;
}

@media (max-width: 768px) {
  #guestlogin {
    padding: 6px 12px;
    gap: 8px;
  }

  #guestlogin .input-group-addon {
    font-size: 0.7rem;
  }
}

/* Bottom action buttons container */
.btfw-chat-actions{
  display:flex;
  align-items:center;
  justify-content:flex-start;
  flex-wrap:wrap;
  gap:8px;
  width:100%;
  padding-top:6px;
  border-top:1px solid color-mix(in srgb, var(--btfw-border) 55%, transparent 45%);
  margin-top:2px;
}
.btfw-chat-actions #usercount{
  margin-left:auto;
  order: 100;
  flex-shrink: 0;
}
.button.btfw-chatbtn{ display:inline-flex; align-items:center; gap:6px; }

/* Bottom bar should not have margin-bottom to avoid extra space */
#chatwrap .btfw-chat-bottombar:last-child {
  margin-bottom: 0;
}

/* Avatars next to names */
.btfw-chat-avatar{
  width: 28px; height: 28px;
  border-radius: 8px;
  margin-right: 8px;
  vertical-align: middle;
  object-fit: cover;
  box-shadow: 0 1px 4px color-mix(in srgb, var(--btfw-color-bg) 40%, transparent 60%);
}
#messagebuffer .btfw-chat-avatar + .username{ vertical-align: middle; }

.chat-msg-\$server\$ { background: rgba(255, 255, 255, 0.07); border-radius: 1000px; color: hsla(305, 13%, 34%, 0.84); font-size: 8pt; font-style: italic; height: 10px; line-height: 12px; margin: 0px auto; overflow: hidden; padding: 5px 10px; position: relative; transition: bottom 0.5s cubic-bezier(0.42, 0.0, 0.58, 1.0); width: 0; }

/* Emote size inside chat messages */
#messagebuffer img.emoji,
#messagebuffer img.emote,
#messagebuffer .emote{
  max-height: 32px; vertical-align: middle;
}

/* Mobile refinements */
@media (max-width: 768px){
  .btfw-controls-row{ flex-wrap:wrap; }
  #chatline{ flex: 1 1 100%; }
  
  /* On mobile, chat should fill available space but not overflow */
  #chatwrap {
    max-height: 100%;
    overflow: hidden;
  }
}

/* Rest of existing chat.css styles... */
/* chat-tools toolbar */
#btfw-chattools{
  display:flex; align-items:center; justify-content:space-between;
  gap:8px; padding:6px; margin-bottom:6px;
  border:1px solid var(--btfw-border);
  border-radius:12px; background: color-mix(in srgb, var(--btfw-color-panel) 84%, transparent 16%);
}
#btfw-chattools .btfw-ct{ border-radius:10px; }
#btfw-ct-swatch{
  position: sticky; margin-top:6px; right:6px;
  display:grid; grid-template-columns: repeat(8, 22px); gap:6px;
  padding:8px; border-radius:10px;
  background: color-mix(in srgb, var(--btfw-color-panel) 90%, transparent 10%);
  border:1px solid var(--btfw-border);
  box-shadow: 0 10px 26px color-mix(in srgb, var(--btfw-color-bg) 35%, transparent 65%);
  z-index: 4700;
}
#btfw-ct-swatch.is-hidden{ display:none; }
.btfw-ct-swatchbtn{
  width:22px; height:22px; border-radius:6px; border:0; cursor:pointer;
}

/* === Chat Tools Panel (opens above input, inside chat column) === */
#chatwrap { position: relative; } /* ensure absolute anchoring */

.btfw-ct-pop{
  position: absolute;
  left: 8px; right: 8px; bottom: 86px; /* JS adjusts bottom at runtime */
  background: color-mix(in srgb, var(--btfw-color-panel) 92%, transparent 8%);
  border: 1px solid var(--btfw-border);
  border-radius: 12px;
  box-shadow: 0 16px 40px color-mix(in srgb, var(--btfw-color-bg) 38%, transparent 62%);
  padding: 10px;
  z-index: 4700;
}
.btfw-ct-pop.is-hidden{ display: none; }

.btfw-ct-grid{
  display: grid;
  grid-template-columns: repeat(4, minmax(90px,1fr));
  gap: 8px;
}
.btfw-ct-item{
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap: 4px;
  padding: 10px 8px;
  border-radius: 10px;
  background: color-mix(in srgb, var(--btfw-color-panel) 78%, transparent 22%);
  border: 1px solid var(--btfw-border);
  cursor: pointer;
  user-select: none;
}
.btfw-ct-item:hover{ background: color-mix(in srgb, var(--btfw-color-accent) 34%, transparent 66%); }
.btfw-ct-item > span { font-size: 12px; opacity: .9; }

.btfw-ct-swatch{
  margin-top: 10px;
  display:grid; grid-template-columns: repeat(10, 22px); gap: 6px;
  padding: 8px;
  border-radius: 10px;
  background: color-mix(in srgb, var(--btfw-color-panel) 90%, transparent 10%);
  border: 1px solid var(--btfw-border);
}
.btfw-ct-swatch.is-hidden{ display:none; }
.btfw-ct-swatchbtn{
  width:22px; height:22px; border-radius:6px; border:0; cursor:pointer;
}

@media (max-width: 768px){
  .btfw-ct-grid{ grid-template-columns: repeat(3, minmax(90px,1fr)); }
}

/* === Chat Tools Mini Modal (inside chat column) === */
#chatwrap { position: relative; }

#btfw-ct-modal{
  position: absolute; inset: 0;
  display: none;
  z-index: 4800;
}
#btfw-ct-modal.is-active{ display: block; }
#btfw-ct-modal .btfw-ct-backdrop{
  position: absolute; inset: 0;
  background: color-mix(in srgb, var(--btfw-color-bg) 40%, black 60%);
  border-radius: 12px; /* matches chat column rounding if any */
}
#btfw-ct-modal .btfw-ct-card{
  position: absolute;
  background: linear-gradient(180deg,
    color-mix(in srgb, var(--btfw-color-panel) 90%, transparent 10%),
    color-mix(in srgb, var(--btfw-color-surface) 88%, transparent 12%));
  border: 1px solid var(--btfw-border);
  border-radius: 14px;
  box-shadow: 0 18px 44px color-mix(in srgb, var(--btfw-color-bg) 34%, transparent 66%);
  color: var(--btfw-color-text);
  overflow: hidden;
}
#btfw-ct-modal .btfw-ct-cardhead{
  display:flex; align-items:center; justify-content:space-between;
  padding: 10px 12px;
  background: linear-gradient(90deg,
    color-mix(in srgb, var(--btfw-color-accent) 96%, transparent 4%),
    color-mix(in srgb, var(--btfw-color-accent) 80%, white 20%));
  color: var(--btfw-color-text); font-weight: 600; letter-spacing: .2px;
}
#btfw-ct-modal .btfw-ct-close{
  background: transparent;
  border: 0;
  color: var(--btfw-color-on-accent);
  font-size: 18px;
  cursor: pointer;
}
#btfw-ct-modal .btfw-ct-body{ padding: 10px 12px 12px; }

#btfw-ct-modal .btfw-ct-grid{
  display:grid; grid-template-columns: repeat(5, minmax(80px,1fr));
  gap: 8px; margin-bottom: 10px;
}
#btfw-ct-modal .btfw-ct-item{
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap: 3px; padding:10px 8px; cursor:pointer;
  border-radius: 10px;
  background: color-mix(in srgb, var(--btfw-color-surface) 82%, transparent 18%);
  border: 1px solid color-mix(in srgb, var(--btfw-border) 72%, transparent 28%);
}
#btfw-ct-modal .btfw-ct-item:hover{ background: color-mix(in srgb, var(--btfw-color-accent) 32%, transparent 68%); }
#btfw-ct-modal .btfw-ct-item > span{ font-size: 12px; opacity:.9; }

#btfw-ct-modal .btfw-ct-section{ margin-top: 6px; }
#btfw-ct-modal .btfw-ct-row{
  display:flex; align-items:center; justify-content:space-between; margin-bottom: 8px;
}
#btfw-ct-modal .btfw-ct-title{ font-weight:600; opacity:.95; }

#btfw-ct-swatch{
  display:grid; grid-template-columns: repeat(10, 22px); gap:6px;
}
#btfw-ct-swatch .btfw-ct-swatchbtn{
  width:22px; height:22px; border-radius:6px; border:0; cursor:pointer;
}

#btfw-ct-modal .btfw-ct-actions{
  display:flex; align-items:center; gap:8px; margin-top:8px;
}
#btfw-ct-modal .btfw-ct-hex{
  width:110px; background:color-mix(in srgb, var(--btfw-color-panel) 86%, transparent 14%); color:var(--btfw-color-text); border:1px solid color-mix(in srgb, var(--btfw-border) 76%, transparent 24%);
  border-radius:8px; padding:6px 8px;
}

/* Chat composer input + button polish */
#chatline{
  flex: 1 1 auto;
  min-width: 0;
  background: color-mix(in srgb, var(--btfw-color-panel) 74%, transparent 26%);
  color: var(--btfw-color-text);
  border: 1px solid color-mix(in srgb, var(--btfw-border) 60%, transparent 40%);
  border-radius: 999px;
  padding: 10px 16px;
  min-height: 44px;
  line-height: 1.25;
  box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--btfw-color-panel) 92%, transparent 8%);
  transition: border-color .2s ease, box-shadow .2s ease;
}

#chatline:focus{
  outline: none;
  border-color: color-mix(in srgb, var(--btfw-color-accent) 60%, transparent 40%);
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--btfw-color-accent) 22%, transparent 78%);
}

.btfw-chat-actions .button.btfw-chatbtn{
  border-radius: 999px;
  padding: 8px 8px;
  background: radial-gradient(120% 140% at 28% 28%, color-mix(in srgb, var(--btfw-color-accent) 28%, transparent 72%), color-mix(in srgb, var(--btfw-color-panel) 78%, transparent 22%));
  border: 1px solid color-mix(in srgb, var(--btfw-border) 68%, transparent 32%);
  box-shadow: inset 0 1px 0 color-mix(in srgb, white 18%, transparent 82%);
  transition: filter .2s ease, transform .2s ease;
}

.btfw-chat-actions .button.btfw-chatbtn:hover{
  filter: brightness(1.08);
  transform: translateY(-1px);
}

/* Responsive modal grid on phones */
@media (max-width: 768px){
  #btfw-ct-modal .btfw-ct-grid{ grid-template-columns: repeat(3, minmax(80px,1fr)); }
}

/* Fallback quick control styling (if Theme Settings modal is absent) */
.btfw-avatars-dd .btfw-avatars-select{
  background: color-mix(in srgb, var(--btfw-color-panel) 80%, transparent 20%);
  border: 1px solid var(--btfw-border);
  color: var(--btfw-color-text);
  border-radius: 8px;
  padding: 4px 8px;
}
/* Chat text size is controlled by a CSS var set by Theme Settings */
#messagebuffer { font-size: var(--btfw-chat-text, 14px); line-height: 1.35; }

#messagebuffer .btfw-chat-trivia {
  margin: 6px 0 0;
  padding: 12px 16px;
  border-radius: 16px;
  background: color-mix(in srgb, var(--btfw-color-panel) 88%, transparent 12%);
  border: 1px solid color-mix(in srgb, var(--btfw-color-accent) 24%, transparent 76%);
  box-shadow: 0 12px 28px color-mix(in srgb, var(--btfw-color-bg) 40%, transparent 60%);
  display: flex;
  flex-direction: column;
  gap: 10px;
}

#messagebuffer .btfw-chat-trivia__question {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  font-weight: 600;
  color: var(--btfw-color-chat-text);
}

#messagebuffer .btfw-chat-trivia__icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: 12px;
  background: color-mix(in srgb, var(--btfw-color-accent) 22%, transparent 78%);
  box-shadow: 0 8px 20px color-mix(in srgb, var(--btfw-color-accent) 28%, transparent 72%);
  font-size: 18px;
}

#messagebuffer .btfw-chat-trivia__prompt {
  flex: 1 1 auto;
  min-width: 0;
}

#messagebuffer .btfw-chat-trivia__meta {
  font-size: 0.78rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  font-weight: 600;
  color: color-mix(in srgb, var(--btfw-color-chat-text) 70%, transparent 30%);
}

#messagebuffer .btfw-chat-trivia__options {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

#messagebuffer .btfw-chat-trivia__option {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  border-radius: 12px;
  background: color-mix(in srgb, var(--btfw-trivia-option-color, var(--btfw-color-accent)) 16%, transparent 84%);
  color: var(--btfw-color-chat-text);
  box-shadow: 0 10px 20px color-mix(in srgb, var(--btfw-trivia-option-color, var(--btfw-color-accent)) 24%, transparent 76%);
  transition: transform 0.18s ease, box-shadow 0.18s ease;
}

#messagebuffer .btfw-chat-trivia__option:hover {
  transform: translateY(-1px);
  box-shadow: 0 16px 28px color-mix(in srgb, var(--btfw-trivia-option-color, var(--btfw-color-accent)) 32%, transparent 68%);
}

#messagebuffer .btfw-chat-trivia__badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: color-mix(in srgb, var(--btfw-trivia-option-color, var(--btfw-color-accent)) 58%, transparent 42%);
  color: var(--btfw-color-on-accent);
  font-weight: 700;
  font-size: 0.85rem;
}

#messagebuffer .btfw-chat-trivia__label {
  flex: 1 1 auto;
  min-width: 0;
  font-weight: 600;
}

@media (max-width: 768px) {
  #messagebuffer .btfw-chat-trivia {
    padding: 10px 12px;
    border-radius: 14px;
  }

  #messagebuffer .btfw-chat-trivia__options {
    gap: 6px;
  }
}

#chatwrap .btfw-newmessages-slot{
  display: flex;
  justify-content: center;
  margin: 6px 0;
}

#chatwrap .btfw-newmessages-slot #newmessages-indicator{
  position: relative;
  left: auto;
  right: auto;
  bottom: auto;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 14px;
  border-radius: 999px;
  background: linear-gradient(135deg,
    color-mix(in srgb, var(--btfw-color-panel) 88%, transparent 12%),
    color-mix(in srgb, var(--btfw-color-accent) 38%, var(--btfw-color-panel) 62%));
  border: 1px solid color-mix(in srgb, var(--btfw-color-accent) 42%, transparent 58%);
  color: var(--btfw-color-text);
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.01em;
  box-shadow: 0 12px 28px color-mix(in srgb, var(--btfw-color-bg) 32%, transparent 68%);
  cursor: pointer;
  transition: transform 0.16s ease, box-shadow 0.16s ease;
}

#chatwrap .btfw-newmessages-slot #newmessages-indicator:hover{
  transform: translateY(-2px);
  box-shadow: 0 16px 32px color-mix(in srgb, var(--btfw-color-accent) 35%, transparent 65%);
}

#chatwrap .btfw-newmessages-slot #newmessages-indicator .glyphicon{
  font-size: 12px;
}

#chatwrap .btfw-newmessages-slot #newmessages-indicator.hidden{
  display: none !important;
}

/* ===== Chat Avatars (generic for chat-msg-* roots) ===== */

#chatwrap.btfw-avatars-off  .btfw-chat-avatar { display: none !important; }
#chatwrap.btfw-avatars-off  .btfw-chat-avatarwrap { display: none !important; }


/* Inline emoji images sized like text */
img.twemoji { width: 1em; height: 1em; vertical-align: -0.15em; }
#messagebuffer img.twemoji { width: 1.1em; height: 1.1em; }

#userlist, #messagebuffer, #chatheader, #videowrap-header {
    border: 0 solid transparent!important;
        scroll-behavior: smooth;
    overflow-x: hidden;
}

#userlist {
  max-height: clamp(220px, calc(100vh - 360px), 420px);
  overflow-y: auto;
  overscroll-behavior: contain;
  scrollbar-width: thin;
  scrollbar-gutter: stable both-edges;
  padding-right: 4px;
}

#userlist::-webkit-scrollbar {
  width: 8px;
}

#userlist::-webkit-scrollbar-thumb {
  background: var(--btfw-scrollbar-thumb);
  border-radius: 999px;
}

#userlist::-webkit-scrollbar-thumb:hover {
  background: var(--btfw-scrollbar-thumb-hover);
}

#userlist::-webkit-scrollbar-track {
  background: transparent;
}

:root { --btfw-emote-size: 130px; } /* default medium = 130px */

#messagebuffer img.channel-emote,
#messagebuffer img.giphy.chat-picture,
#messagebuffer img.tenor.chat-picture {
  width: auto !important;
  height: auto !important;
  max-width: var(--btfw-emote-size) !important;
  max-height: var(--btfw-emote-size) !important;
  object-fit: contain;
  display: inline-block;
  vertical-align: middle;
  margin: 2px 3px;
  border-radius: 8px;
}

/* Make chat emojis bigger (Twemoji images) */
#messagebuffer img.twemoji {
  width: var(--btfw-chat-emoji-size, 26px);
  height: var(--btfw-chat-emoji-size, 26px);
  vertical-align: -0.15em;
  opacity: 0;
  transition: opacity .12s ease-in;
}
#messagebuffer img.twemoji.is-ready { opacity: 1; }

/* Username color */
#messagebuffer .username.btfw-username-colored {
  color: var(--btfw-name-color) !important;
}

:root { --btfw-avatar-size: 40px; }

#messagebuffer .btfw-chat-avatarwrap {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-right: 0px;
  flex: 0 0 var(--btfw-avatar-size);
  width: var(--btfw-avatar-size);
  height: var(--btfw-avatar-size);
  vertical-align: middle;
}
#messagebuffer .btfw-chat-avatar {
  width: var(--btfw-avatar-size);
  height: var(--btfw-avatar-size);
  border-radius: 10px;
  object-fit: cover;
  display: block;
}

/* consecutive compaction: remove top gap */
#messagebuffer > div.btfw-compact { margin-top: 2px !important; }

/* hide timestamps when off */
body.btfw-ts-hide #messagebuffer .timestamp { display:none !important; }

/* Muted user indicator in userlist */
#userlist li.btfw-muted { opacity: .55; }
#userlist .btfw-mute-chip {
  margin-left: 6px;
  padding: 2px 6px;
  font-size: 11px;
  border: 0;
  border-radius: 10px;
  cursor: pointer;
  background: var(--btfw-chip-bg);
  color: var(--btfw-chip-text);
}
#userlist .btfw-mute-chip:hover {
  background: var(--btfw-chip-bg-hover);
}

#usercount.btfw-usercount {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    opacity: .9;
    margin-left: auto;
    padding: 6px 12px;
    background: transparent;
    border: 0;
    color: color-mix(in srgb, var(--btfw-color-chat-text) 86%, transparent 14%);
    cursor: pointer;
    transition: opacity 0.15s ease;
    justify-content: flex-end;
}

#usercount.btfw-usercount:hover {
  opacity: 1;
}

#usercount.btfw-usercount::before {
  content: "\f0c0";
  font-family: "Font Awesome 5 Free", "Font Awesome 5 Pro", "Font Awesome 5", "FontAwesome", sans-serif;
  font-weight: 900;
  font-size: 14px;
  opacity: .75;
  line-height: 1;
}
.server-msg-reconnect {
  border: 0px solid #009900!important;
  border-radius: 10px;
}
/* ==========================================
   SPECIAL USERNAME EFFECTS
   ========================================== */

/* VIP Tier 1 - Blue Gradient with Sparkles */
.VIP2 {
    --bg-pos: .2em -.07em;
    -webkit-background-clip: border-box, text;
    -webkit-text-fill-color: transparent;
    animation: starkrdp-anim 3s linear infinite;
    background-image: url(https://media.giphy.com/media/eYRGWfchREFUUlXT7P/giphy.gif), linear-gradient(302deg, #24599d 0%, #fff 100%);
    background-size: 10em, 17em;
    font-weight: bold;
    position: relative;
    text-shadow: 1px 2px 12px rgba(98, 207, 203, 0.2);
}

/* VIP Tier 2 - Pink/Purple Gradient */
.VIP {
    -webkit-background-clip: border-box, border-box, text;
    -webkit-text-fill-color: transparent;
    animation: playboy 3.5s cubic-bezier(0.4, 0, 1, 1) 0s running;
    background-image: url(https://i.imgur.com/cWvW3KS.gif), url(https://i.imgur.com/jxlCmc9.gif), linear-gradient(200deg, rgb(254 39 191) 20%, rgb(254 39 191) 30%, rgb(254 39 191) 40%, rgb(254 39 91) 50%, rgb(254 39 191) 60%, rgb(255, 31, 110) 70%, rgb(255, 55, 255) 80%);
    background-size: 10em, 10em, 5em;
    font-weight: bold;
    text-shadow: 1px 1px 15px rgb(255 0 224 / 88%);
    transition: .3s;
}

/* VIP Tier 3 - Green Sparkle with Border */
.VIP3 {
    -webkit-background-clip: border-box, border-box, text;
    -webkit-text-fill-color: transparent;
    background-image: url(https://i.ibb.co/R60RZRS/sparkling.gif), url(https://i.ibb.co/R60RZRS/sparkling.gif), linear-gradient(178deg, #199800, #2aff00, #199800);
    background-size: 10em, 10em, 5em;
    border-bottom: 5px dotted #2aff00;
    font-weight: bold;
    text-shadow: 1px 1px 5px #2aff00;
}

/* VIP Tier 4 - Rainbow Effect */
.VIP4 {
    -webkit-background-clip: border-box, text !important;
    -webkit-text-fill-color: transparent !important;
    animation: logfo-animation 4s linear infinite !important;
    background-image: url(https://i.ibb.co/fQh97LR/particles-log-fo.gif), repeating-linear-gradient(90deg, #fff 0%, #FF0000 15%, #FF8000 25%, #F7FF00 35%, #FF0000 45%, #55FF00 55%, #03FFFF 65%, #0022FF 75%, #A100FF 85%, #FF00E6 95%, #fff 100%) !important;
    background-size: 4em, 500px !important;
    border-radius: 11px;
    filter: saturate(2) !important;
    font-weight: 600 !important;
    padding: 13px;
    text-shadow: 2px 2px 15px #000000 !important;
}

/* VIP Tier 5 - Blue Lightning */
.VIP5 {
    -webkit-background-clip: text, text, border-box, border-box, border-box;
    -webkit-text-fill-color: transparent;
    animation: myproxiesanim 5s linear infinite;
    background-image: url(https://i.imgur.com/k6rhOtN.gif), radial-gradient(circle, rgba(21, 170, 255, 1) 8%, rgba(85, 208, 255, 1) 19%, rgba(173, 247, 242, 1) 35%, rgba(156, 238, 243, 1) 60%, rgba(21, 170, 255, 1) 70%, rgba(8, 8, 255, 1) 87%, rgba(255, 255, 255, 1) 100%), url(https://i.ibb.co/DtJBDNy/white-lightning.gif), url(https://i.imgur.com/afWakbq.gif);
    background-size: 5em, 15% 800%, 10em, 25em;
    font-weight: 1000;
    position: relative;
    transition: .3s;
}

/* ==========================================
   CUSTOM USERNAME EFFECTS (Examples from base.css)
   ========================================== */

/* bill username - Blue gradient with sparkles */
.chat-msg-bill .username {
    --bg-pos: .2em -.07em;
    -webkit-background-clip: border-box, text;
    -webkit-text-fill-color: transparent;
    background-image: url(https://media.giphy.com/media/eYRGWfchREFUUlXT7P/giphy.gif), linear-gradient(302deg, #24599d 0%, #fff 100%);
    background-size: 10em, 17em;
    font-weight: 1000;
    position: relative;
    text-shadow: 1px 2px 12px rgb(98 207 203 / 50%);
}

/* bill2 username - Orange gradient with animated divider */
.chat-msg-bill2 .username {
    --bg-pos: .2em -.07em;
    -webkit-background-clip: border-box, text;
    -webkit-text-fill-color: transparent;
    background-image: url(https://shadow-of-valtus.neocities.org/Graphics/Dividers/kingluludeer_eyedivider.gif), linear-gradient(323deg, #a33000 0%, #ff8d00d9 100%);
    background-size: 14em, 18em;
    font-weight: 1000;
    position: relative;
    text-shadow: 1px 2px 12px rgb(108 199 0 / 50%);
}

/* CherryRound username - Red gradient */
.chat-msg-CherryRound .username {
    --bg-pos: .2em -.07em;
    -webkit-background-clip: border-box, text;
    -webkit-text-fill-color: transparent;
    background-image: url(https://media.giphy.com/media/eYRGWfchREFUUlXT7P/giphy.gif), linear-gradient(302deg, #cd0000 0%, #6f0202 100%);
    background-size: 10em, 17em;
    font-weight: 1000;
    position: relative;
    text-shadow: 1px 2px 12px rgb(255 0 0 / 50%);
}

/* Zeb-Dev username - Cyan/blue lightning effect */
.chat-msg-Zeb-Dev .username {
    -webkit-background-clip: text, text, border-box, border-box, border-box;
    -webkit-text-fill-color: transparent;
    animation: myproxiesanim 5s linear infinite;
    background-image: url(https://i.imgur.com/k6rhOtN.gif), radial-gradient(circle, rgba(21, 170, 255, 1) 8%, rgba(85, 208, 255, 1) 19%, rgba(173, 247, 242, 1) 35%, rgba(156, 238, 243, 1) 60%, rgba(21, 170, 255, 1) 70%, rgb(8 255 177) 87%, rgba(255, 255, 255, 1) 100%), url(https://i.ibb.co/DtJBDNy/white-lightning.gif), url(https://i.imgur.com/afWakbq.gif);
    background-size: 5em, 15% 800%, 10em, 25em;
    font-weight: 1000;
    position: relative;
    transition: .3s;
}

/* Vices username - Purple glow */
.chat-msg-Vices .username {
    -webkit-text-fill-color: #922fffbf;
    animation: lights 8s 750ms linear infinite;
    font-weight: 1000;
}
.chat-msg-Nailgun .username {
    -webkit-background-clip: text, text, border-box, border-box, border-box;
    -webkit-text-fill-color: transparent;
    animation: myproxiesanim 20s 
linear infinite;
    background-image: url(https://i.imgur.com/k6rhOtN.gif), radial-gradient(circle, rgb(21 255 32) 8%, rgb(202 255 74) 19%, rgba(173, 247, 242, 1) 35%, rgba(156, 238, 243, 1) 60%, rgba(21, 170, 255, 1) 70%, rgb(65 0 118) 87%, rgba(255, 255, 255, 1) 100%), url(https://i.ibb.co/DtJBDNy/white-lightning.gif), url(https://i.imgur.com/afWakbq.gif);
    background-size: 5em, 15% 800%, 10em, 25em;
    position: relative;
    transition: .3s;
}
.chat-msg-hunchback .username {
    -webkit-background-clip: border-box, border-box, text;
    -webkit-text-fill-color: transparent;
    animation: playboy 3.5s 
cubic-bezier(0.4, 0, 1, 1) 0s running;
    background-image: url(https://i.imgur.com/cWvW3KS.gif), url(https://i.imgur.com/jxlCmc9.gif), linear-gradient(200deg, rgb(39 85 254) 20%, rgb(209 74 147) 30%, rgb(254 39 39) 40%, rgb(254 39 91) 50%, rgb(254 39 191) 60%, rgb(255 33 84) 70%, rgb(231 85 85) 80%);
    background-size: 10em, 10em, 5em;
    font-weight: bold;
    text-shadow: 1px 1px 15px rgb(255 173 173 / 62%);
    transition: .3s;
}
.chat-msg-RandomRetard .username {
    -webkit-background-clip: border-box, border-box, text;
    -webkit-text-fill-color: transparent;
    background-image: url(https://i.ibb.co/R60RZRS/sparkling.gif), url(https://i.ibb.co/R60RZRS/sparkling.gif), linear-gradient(178deg, #419800, #66ffb4, #00983d);
    background-size: 7em, 7em, 5em;
    font-weight: bold;
    text-shadow: 1px 1px 5px #0c955c;
}



/* ==========================================
   REQUIRED ANIMATIONS
   ========================================== */

@keyframes starkrdp-anim {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes playboy {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes logfo-animation {
    0% { background-position: 0 0; }
    100% { background-position: 500px 0; }
}

@keyframes myproxiesanim {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes lights {
    0%, 100% { text-shadow: 0 0 10px #922fff, 0 0 20px #922fff, 0 0 30px #922fff; }
    50% { text-shadow: 0 0 5px #922fff, 0 0 10px #922fff, 0 0 15px #922fff; }
}












