/* ======================================================================
   BillTube Framework â€“ chat.css
   Chat column structure, message area, avatars, and controls row
   ====================================================================== */

#chatwrap{
  display:flex;
  flex-direction: column;
  height: 100%; /* Fill the chatcol container */
  min-height: 0;
  width: 100%;
  overflow: hidden; /* Prevent overflow issues */
}

/* Bars are visually styled further in overlays.css */
#chatwrap .btfw-chat-topbar,
#chatwrap .btfw-chat-bottombar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  padding:8px 10px;
  margin:0 0 8px 0;
  border:1px solid var(--btfw-border);
  border-radius: var(--btfw-radius);
  flex-shrink: 0; /* Don't shrink these bars */
}

.btfw-chat-topbar-left{
  display:flex;
  align-items:center;
  gap: 10px;
  flex: 1 1 auto;
  min-width: 0;
}

.btfw-chat-topbar-actions{
  display:flex;
  align-items:center;
  gap: 6px;
  flex: 0 0 auto;
}

#btfw-nowplaying-slot{
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

#btfw-mobile-modules-toggle{
  display: none;
  align-items: center;
  justify-content: center;
  padding: 6px 10px;
}

#btfw-grid.btfw-grid--vertical #btfw-mobile-modules-toggle{
  display: inline-flex;
}

/* Scrollable messages - this should take all remaining space */
#messagebuffer{
  flex: 1 1 auto;
  overflow: auto;
  min-height: 0; /* Allow shrinking */
  padding: 6px;
  /* Ensure smooth scrolling */
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

#messagebuffer > div {
  display: flex;
  flex-wrap: nowrap;
  align-items: flex-start;
  gap: 8px;
  padding: 4px 10px;
  position: relative;
  width: 100%;
  box-sizing: border-box;
}

#messagebuffer > div .timestamp {
  order: 3;
  margin-left: auto !important;
  display: inline-flex;
  align-items: center;
  justify-content: flex-end;
  flex: 0 0 auto;
  text-align: right;
  min-width: max-content;
  white-space: nowrap;
  opacity: .65;
  font-size: 0.8em;
  padding-left: 12px;
  color: color-mix(in srgb, var(--btfw-color-chat-text) 70%, transparent 30%);
}

#messagebuffer > div span.timestamp ~ span {
  order: 2;
  display: inline-flex;
  align-items: flex-start;
  gap: 6px;
  flex: 0 0 auto;
}

#messagebuffer > div span.timestamp + span {
  flex-wrap: nowrap;
}

#messagebuffer > div span.timestamp ~ span:last-child {
  flex: 1 1 auto;
  min-width: 0;
  word-break: break-word;
}

#messagebuffer > div.btfw-has-avatar span.timestamp + span {
  align-items: center;
}

#messagebuffer > div span .username,
#messagebuffer > div span .nick,
#messagebuffer > div span .name {
  font-weight: 600;
}

#messagebuffer > div.server-msg,
#messagebuffer > div.server-msg-reconnect {
  display: block;
}

/* Keep images/GIFs reasonable inside chat */
#messagebuffer .chat-msg img{
  max-width: 100%;
  height: auto;
}

/* Controls row sits below messages, stays visible */
.btfw-controls-row{
  display:flex;
  gap:8px;
  align-items:center;
  padding:6px;
  border-top:1px solid var(--btfw-border);
  background: color-mix(in srgb, var(--btfw-color-panel) 84%, transparent 16%);
  border-radius: 10px;
  margin-top:6px;
  flex-shrink: 0; /* Don't shrink the controls */
}

/* Bottom action buttons container */
.btfw-chat-actions{ display:flex; gap:6px; flex-wrap:wrap; }
.button.btfw-chatbtn{ display:inline-flex; align-items:center; gap:6px; }

/* Bottom bar should not have margin-bottom to avoid extra space */
#chatwrap .btfw-chat-bottombar:last-child {
  margin-bottom: 0;
}

/* Avatars next to names */
.btfw-chat-avatar{
  width: 28px; height: 28px;
  border-radius: 8px;
  margin-right: 8px;
  vertical-align: middle;
  object-fit: cover;
  box-shadow: 0 1px 4px color-mix(in srgb, var(--btfw-color-bg) 40%, transparent 60%);
}
#messagebuffer .btfw-chat-avatar + .username{ vertical-align: middle; }

/* Emote size inside chat messages */
#messagebuffer img.emoji,
#messagebuffer img.emote,
#messagebuffer .emote{
  max-height: 32px; vertical-align: middle;
}

/* Mobile refinements */
@media (max-width: 768px){
  .btfw-controls-row{ flex-wrap:wrap; }
  #chatline{ flex: 1 1 100%; }
  
  /* On mobile, chat should fill available space but not overflow */
  #chatwrap {
    max-height: 100%;
    overflow: hidden;
  }
}

/* Rest of existing chat.css styles... */
/* chat-tools toolbar */
#btfw-chattools{
  display:flex; align-items:center; justify-content:space-between;
  gap:8px; padding:6px; margin-bottom:6px;
  border:1px solid var(--btfw-border);
  border-radius:12px; background: color-mix(in srgb, var(--btfw-color-panel) 84%, transparent 16%);
}
#btfw-chattools .btfw-ct{ border-radius:10px; }
#btfw-ct-swatch{
  position: sticky; margin-top:6px; right:6px;
  display:grid; grid-template-columns: repeat(8, 22px); gap:6px;
  padding:8px; border-radius:10px;
  background: color-mix(in srgb, var(--btfw-color-panel) 90%, transparent 10%);
  border:1px solid var(--btfw-border);
  box-shadow: 0 10px 26px color-mix(in srgb, var(--btfw-color-bg) 35%, transparent 65%);
  z-index: 4700;
}
#btfw-ct-swatch.is-hidden{ display:none; }
.btfw-ct-swatchbtn{
  width:22px; height:22px; border-radius:6px; border:0; cursor:pointer;
}

/* === Chat Tools Panel (opens above input, inside chat column) === */
#chatwrap { position: relative; } /* ensure absolute anchoring */

.btfw-ct-pop{
  position: absolute;
  left: 8px; right: 8px; bottom: 86px; /* JS adjusts bottom at runtime */
  background: color-mix(in srgb, var(--btfw-color-panel) 92%, transparent 8%);
  border: 1px solid var(--btfw-border);
  border-radius: 12px;
  box-shadow: 0 16px 40px color-mix(in srgb, var(--btfw-color-bg) 38%, transparent 62%);
  padding: 10px;
  z-index: 4700;
}
.btfw-ct-pop.is-hidden{ display: none; }

.btfw-ct-grid{
  display: grid;
  grid-template-columns: repeat(4, minmax(90px,1fr));
  gap: 8px;
}
.btfw-ct-item{
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap: 4px;
  padding: 10px 8px;
  border-radius: 10px;
  background: color-mix(in srgb, var(--btfw-color-panel) 78%, transparent 22%);
  border: 1px solid var(--btfw-border);
  cursor: pointer;
  user-select: none;
}
.btfw-ct-item:hover{ background: color-mix(in srgb, var(--btfw-color-accent) 34%, transparent 66%); }
.btfw-ct-item > span { font-size: 12px; opacity: .9; }

.btfw-ct-swatch{
  margin-top: 10px;
  display:grid; grid-template-columns: repeat(10, 22px); gap: 6px;
  padding: 8px;
  border-radius: 10px;
  background: color-mix(in srgb, var(--btfw-color-panel) 90%, transparent 10%);
  border: 1px solid var(--btfw-border);
}
.btfw-ct-swatch.is-hidden{ display:none; }
.btfw-ct-swatchbtn{
  width:22px; height:22px; border-radius:6px; border:0; cursor:pointer;
}

@media (max-width: 768px){
  .btfw-ct-grid{ grid-template-columns: repeat(3, minmax(90px,1fr)); }
}

/* === Chat Tools Mini Modal (inside chat column) === */
#chatwrap { position: relative; }

#btfw-ct-modal{
  position: absolute; inset: 0;
  display: none;
  z-index: 4800;
}
#btfw-ct-modal.is-active{ display: block; }
#btfw-ct-modal .btfw-ct-backdrop{
  position: absolute; inset: 0;
  background: color-mix(in srgb, var(--btfw-color-bg) 40%, black 60%);
  border-radius: 12px; /* matches chat column rounding if any */
}
#btfw-ct-modal .btfw-ct-card{
  position: absolute;
  background: linear-gradient(180deg,
    color-mix(in srgb, var(--btfw-color-panel) 90%, transparent 10%),
    color-mix(in srgb, var(--btfw-color-surface) 88%, transparent 12%));
  border: 1px solid var(--btfw-border);
  border-radius: 14px;
  box-shadow: 0 18px 44px color-mix(in srgb, var(--btfw-color-bg) 34%, transparent 66%);
  color: var(--btfw-color-text);
  overflow: hidden;
}
#btfw-ct-modal .btfw-ct-cardhead{
  display:flex; align-items:center; justify-content:space-between;
  padding: 10px 12px;
  background: linear-gradient(90deg,
    color-mix(in srgb, var(--btfw-color-accent) 96%, transparent 4%),
    color-mix(in srgb, var(--btfw-color-accent) 80%, white 20%));
  color: var(--btfw-color-text); font-weight: 600; letter-spacing: .2px;
}
#btfw-ct-modal .btfw-ct-close{
  background: transparent;
  border: 0;
  color: var(--btfw-color-on-accent);
  font-size: 18px;
  cursor: pointer;
}
#btfw-ct-modal .btfw-ct-body{ padding: 10px 12px 12px; }

#btfw-ct-modal .btfw-ct-grid{
  display:grid; grid-template-columns: repeat(5, minmax(80px,1fr));
  gap: 8px; margin-bottom: 10px;
}
#btfw-ct-modal .btfw-ct-item{
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap: 3px; padding:10px 8px; cursor:pointer;
  border-radius: 10px;
  background: color-mix(in srgb, var(--btfw-color-surface) 82%, transparent 18%);
  border: 1px solid color-mix(in srgb, var(--btfw-border) 72%, transparent 28%);
}
#btfw-ct-modal .btfw-ct-item:hover{ background: color-mix(in srgb, var(--btfw-color-accent) 32%, transparent 68%); }
#btfw-ct-modal .btfw-ct-item > span{ font-size: 12px; opacity:.9; }

#btfw-ct-modal .btfw-ct-section{ margin-top: 6px; }
#btfw-ct-modal .btfw-ct-row{
  display:flex; align-items:center; justify-content:space-between; margin-bottom: 8px;
}
#btfw-ct-modal .btfw-ct-title{ font-weight:600; opacity:.95; }

#btfw-ct-swatch{
  display:grid; grid-template-columns: repeat(10, 22px); gap:6px;
}
#btfw-ct-swatch .btfw-ct-swatchbtn{
  width:22px; height:22px; border-radius:6px; border:0; cursor:pointer;
}

#btfw-ct-modal .btfw-ct-actions{
  display:flex; align-items:center; gap:8px; margin-top:8px;
}
#btfw-ct-modal .btfw-ct-hex{
  width:110px; background:color-mix(in srgb, var(--btfw-color-panel) 86%, transparent 14%); color:var(--btfw-color-text); border:1px solid color-mix(in srgb, var(--btfw-border) 76%, transparent 24%);
  border-radius:8px; padding:6px 8px;
}

/* Subtle polish for chat input row to echo style reference */
.btfw-controls-row{
  background: color-mix(in srgb, var(--btfw-color-panel) 82%, transparent 18%);
  border: 1px solid var(--btfw-border);
  box-shadow: 0 8px 24px color-mix(in srgb, var(--btfw-color-bg) 32%, transparent 68%) inset;
  border-radius: 12px;
}
#chatline{
  background: color-mix(in srgb, var(--btfw-color-panel) 78%, transparent 22%);
  color: var(--btfw-color-text);
  border: 1px solid var(--btfw-border);
  border-radius: 10px;
  padding: 8px 10px;
}
.btfw-chat-actions .button.btfw-chatbtn{
  border-radius: 999px;
  background: radial-gradient(120% 120% at 30% 30%, color-mix(in srgb, var(--btfw-color-accent) 26%, transparent 74%), color-mix(in srgb, var(--btfw-color-panel) 78%, transparent 22%));
  border: 1px solid color-mix(in srgb, var(--btfw-border) 72%, transparent 28%);
}
.btfw-chat-actions .button.btfw-chatbtn:hover{ filter: brightness(1.08); }

/* Responsive modal grid on phones */
@media (max-width: 768px){
  #btfw-ct-modal .btfw-ct-grid{ grid-template-columns: repeat(3, minmax(80px,1fr)); }
}

/* Fallback quick control styling (if Theme Settings modal is absent) */
.btfw-avatars-dd .btfw-avatars-select{
  background: color-mix(in srgb, var(--btfw-color-panel) 80%, transparent 20%);
  border: 1px solid var(--btfw-border);
  color: var(--btfw-color-text);
  border-radius: 8px;
  padding: 4px 8px;
}
/* Chat text size is controlled by a CSS var set by Theme Settings */
#messagebuffer { font-size: var(--btfw-chat-text, 14px); line-height: 1.35; }

#chatwrap .btfw-newmessages-slot{
  display: flex;
  justify-content: center;
  margin: 6px 0;
}

#chatwrap .btfw-newmessages-slot #newmessages-indicator{
  position: relative;
  left: auto;
  right: auto;
  bottom: auto;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 14px;
  border-radius: 999px;
  background: linear-gradient(135deg,
    color-mix(in srgb, var(--btfw-color-panel) 88%, transparent 12%),
    color-mix(in srgb, var(--btfw-color-accent) 38%, var(--btfw-color-panel) 62%));
  border: 1px solid color-mix(in srgb, var(--btfw-color-accent) 42%, transparent 58%);
  color: var(--btfw-color-text);
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.01em;
  box-shadow: 0 12px 28px color-mix(in srgb, var(--btfw-color-bg) 32%, transparent 68%);
  cursor: pointer;
  transition: transform 0.16s ease, box-shadow 0.16s ease;
}

#chatwrap .btfw-newmessages-slot #newmessages-indicator:hover{
  transform: translateY(-2px);
  box-shadow: 0 16px 32px color-mix(in srgb, var(--btfw-color-accent) 35%, transparent 65%);
}

#chatwrap .btfw-newmessages-slot #newmessages-indicator .glyphicon{
  font-size: 12px;
}

#chatwrap .btfw-newmessages-slot #newmessages-indicator.hidden{
  display: none !important;
}

/* ===== Chat Avatars (generic for chat-msg-* roots) ===== */

#chatwrap.btfw-avatars-off  .btfw-chat-avatar { display: none !important; }
#chatwrap.btfw-avatars-off  .btfw-chat-avatarwrap { display: none !important; }
#chatwrap.btfw-avatars-small .btfw-chat-avatar { width: 28px; height: 28px; border-radius: 8px; }
#chatwrap.btfw-avatars-big   .btfw-chat-avatar { width: 40px; height: 40px; border-radius: 10px; }

/* Inline emoji images sized like text */
img.twemoji { width: 1em; height: 1em; vertical-align: -0.15em; }
#messagebuffer img.twemoji { width: 1.1em; height: 1.1em; }

#userlist, #messagebuffer, #chatheader, #videowrap-header {
    border: 0 solid transparent!important;
        scroll-behavior: smooth;
    overflow-x: hidden;
}

#userlist {
  max-height: clamp(220px, calc(100vh - 360px), 420px);
  overflow-y: auto;
  overscroll-behavior: contain;
  scrollbar-width: thin;
  scrollbar-gutter: stable both-edges;
  padding-right: 4px;
}

#userlist::-webkit-scrollbar {
  width: 8px;
}

#userlist::-webkit-scrollbar-thumb {
  background: var(--btfw-scrollbar-thumb);
  border-radius: 999px;
}

#userlist::-webkit-scrollbar-thumb:hover {
  background: var(--btfw-scrollbar-thumb-hover);
}

#userlist::-webkit-scrollbar-track {
  background: transparent;
}

:root { --btfw-emote-size: 130px; } /* default medium = 130px */

#messagebuffer img.channel-emote,
#messagebuffer img.giphy.chat-picture,
#messagebuffer img.tenor.chat-picture {
  width: var(--btfw-emote-size) !important;
  height: var(--btfw-emote-size) !important;
  max-width: var(--btfw-emote-size) !important;
  max-height: var(--btfw-emote-size) !important;
  object-fit: contain;
  display: inline-block;
  vertical-align: middle;
  margin: 2px 3px;
  border-radius: 8px;
}

/* Make chat emojis bigger (Twemoji images) */
#messagebuffer img.twemoji {
  width: var(--btfw-chat-emoji-size, 26px);
  height: var(--btfw-chat-emoji-size, 26px);
  vertical-align: -0.15em;
  opacity: 0;
  transition: opacity .12s ease-in;
}
#messagebuffer img.twemoji.is-ready { opacity: 1; }

/* Username color */
#messagebuffer .username.btfw-username-colored {
  color: var(--btfw-name-color) !important;
}

:root { --btfw-avatar-size: 40px; }

#messagebuffer .btfw-chat-avatarwrap {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-right: 6px;
  flex: 0 0 var(--btfw-avatar-size);
  width: var(--btfw-avatar-size);
  height: var(--btfw-avatar-size);
  vertical-align: middle;
}
#messagebuffer .btfw-chat-avatar {
  width: var(--btfw-avatar-size);
  height: var(--btfw-avatar-size);
  border-radius: 6px;
  object-fit: cover;
  display: block;
}

/* consecutive compaction: remove top gap */
#messagebuffer > div.btfw-compact { margin-top: 2px !important; }

/* hide timestamps when off */
body.btfw-ts-hide #messagebuffer .timestamp { display:none !important; }

/* Muted user indicator in userlist */
#userlist li.btfw-muted { opacity: .55; }
#userlist .btfw-mute-chip {
  margin-left: 6px;
  padding: 2px 6px;
  font-size: 11px;
  border: 0;
  border-radius: 10px;
  cursor: pointer;
  background: var(--btfw-chip-bg);
  color: var(--btfw-chip-text);
}
#userlist .btfw-mute-chip:hover {
  background: var(--btfw-chip-bg-hover);
}

/* Chat bottom bar split: actions (left) + usercount (right) */
.btfw-chat-bottombar{
  display:flex; align-items:center; gap:8px;
}
.btfw-chat-actions{ display:flex; align-items:center; gap:6px; }
.btfw-chat-right{ margin-left:auto; display:flex; align-items:center; gap:10px; }

#usercount.btfw-usercount{
  display:flex; align-items:center; gap:6px;
  font-size: 12px; opacity:.9;
}
#usercount .fa-users{ font-size:14px; opacity:.75; }